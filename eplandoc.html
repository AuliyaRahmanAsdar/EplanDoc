<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Plan Doc Kemenag Konawe Kepulauan</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        /* Custom styles for a professional look */
        .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .stat-card {
            border-left: 4px solid #16a34a; /* Green accent */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Main Container -->
    <div id="app" class="container mx-auto p-4 md:p-8">

        <!-- Home Page -->
        <div id="home" class="fade-in">
            <header class="flex flex-col md:flex-row items-center justify-center gap-6 mb-12 text-center md:text-left">
                <img src="logo.png" alt="Logo Kemenag" class="h-20 w-20">
                <div>
                    <h1 class="text-4xl md:text-5xl font-extrabold">
                        <span class="bg-clip-text text-transparent bg-gradient-to-r from-green-500 to-emerald-600">
                            E-Plan Doc
                        </span>
                    </h1>
                    <p class="mt-1 text-xl text-gray-600">Kementerian Agama Kabupaten Konawe Kepulauan</p>
                </div>
            </header>

            <main>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <!-- Menu 1: Data Perencanaan -->
                    <a href="https://drive.google.com/drive/folders/1F6e0uhoKWMDS8bLxKM8AiZM5Js2hrpUg?usp=drive_link" target="_blank" class="card block bg-white p-8 rounded-xl shadow-md text-center">
                        <div class="flex items-center justify-center h-20 w-20 rounded-full bg-green-100 text-green-600 mx-auto mb-6">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                            </svg>
                        </div>
                        <h2 class="text-2xl font-semibold text-gray-800 mb-2">Data Perencanaan</h2>
                        <p class="text-gray-500">Akses dokumen perencanaan melalui Google Drive.</p>
                    </a>

                    <!-- Menu 2: Barang Inventarisasi -->
                    <button onclick="showPage('dashboard')" class="card bg-white p-8 rounded-xl shadow-md text-center">
                        <div class="flex items-center justify-center h-20 w-20 rounded-full bg-blue-100 text-blue-600 mx-auto mb-6">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                        </div>
                        <h2 class="text-2xl font-semibold text-gray-800 mb-2">Barang Inventarisasi</h2>
                        <p class="text-gray-500">Lihat dasbor visualisasi data aset dan inventaris.</p>
                    </button>
                </div>
            </main>
        </div>

        <!-- Dashboard Page -->
        <div id="dashboard" class="hidden fade-in">
            <header class="flex flex-wrap justify-between items-center gap-4 mb-8">
                <div class="flex items-center gap-4">
                     <img src="logo.png" alt="Logo Kemenag" class="h-14 w-14">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Dasbor Inventarisasi</h1>
                        <p class="text-gray-500">Data Aset Barang Milik Negara</p>
                    </div>
                </div>
                <button onclick="showPage('home')" class="bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 border border-gray-300 rounded-lg shadow-sm flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                    Kembali
                </button>
            </header>

            <main>
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-sm font-medium text-gray-500">Total Aset</h3>
                        <p id="total-assets" class="text-3xl font-bold text-gray-800">0</p>
                    </div>
                    <div class="stat-card bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-sm font-medium text-gray-500">Jenis Barang</h3>
                        <p id="unique-items" class="text-3xl font-bold text-gray-800">0</p>
                    </div>
                     <div class="stat-card bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-sm font-medium text-gray-500">Jumlah Unit/Seksi</h3>
                        <p id="total-units" class="text-3xl font-bold text-gray-800">0</p>
                    </div>
                    <div class="stat-card bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-sm font-medium text-gray-500">Kondisi Baik</h3>
                        <p id="good-condition" class="text-3xl font-bold text-gray-800">0%</p>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="font-semibold mb-4 text-gray-700">Jumlah Aset per Unit/Seksi</h3>
                        <canvas id="assetsByUnitChart"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="font-semibold mb-4 text-gray-700">Top 5 Jenis Barang Terbanyak</h3>
                        <canvas id="topItemsChart"></canvas>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                        <h3 class="text-xl font-semibold text-gray-700">Detail Data Inventaris</h3>
                        <div class="flex items-center gap-4 w-full md:w-auto">
                            <select id="unit-filter" class="block w-full md:w-48 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                                <option value="all">Semua Seksi</option>
                            </select>
                            <input type="text" id="table-search" placeholder="Cari barang..." class="block w-full md:w-64 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit/Seksi</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kondisi</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Data rows will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- DATA ---
        // The CSV data from "Barang Inventarisasi Kemenag Konkep Jadi.xlsx - Master Data Fix.csv" is embedded here.
        const csvData = `Unit,Nama Barang,Jumlah,Kondisi
Sekjen,Tanah Bangunan Kantor Pemerintah,1,Baik
Sekjen,Lemari Besi/Metal,4,Baik
Sekjen,Lemari Kayu,1,Baik
Sekjen,Mesin Absensi,2,Baik
Sekjen,Meja Kerja Kayu,9,Baik
Sekjen,Kursi Besi/Metal,33,Baik
Sekjen,Kursi Kayu,3,Baik
Sekjen,Portable Air Conditioner (Alat Pendingin),9,Baik
Sekjen,Camera Electronic,1,Baik
Sekjen,P.C Unit,1,Baik
Sekjen,Laptop,9,Baik
Sekjen,Printer (Peralatan Personal Komputer),4,Baik
Sekjen,Bangunan Gedung Kantor Permanen,1,Baik
Sekjen,Gedung dan Bangunan Dalam Pengerjaan,1,Baik
Bimas,Tanah Bangunan Kantor Pemerintah,3,Baik
Bimas,Tanah Bangunan Balai Nikah,1,Baik
Bimas,Alat Kalibrasi Alinnya,2,Baik
Bimas,Teropong Hilal,1,Baik
Bimas,Lemari Penyimpan,1,Baik
Bimas,Mesin Ketik Manual Langewagon (18-27 Inci),2,Baik
Bimas,Lemari Besi/Metal,3,Baik
Bimas,Lemari Kayu,12,Baik
Bimas,Brandkas,1,Baik
Bimas,Papan Visual/Papan Nama,10,Baik
Bimas,Papan Pengumuman,2,Baik
Bimas,Meja Kerja Kayu,21,Baik
Bimas,Kursi Besi/Metal,83,Baik
Bimas,Kursi Kayu,10,Baik
Bimas,Sofa,1,Baik
Bimas,Meja Rapat,1,Baik
Bimas,Mimbar,1,Baik
Bimas,Filling Cabinet Besi,1,Baik
Bimas,White Board,3,Baik
Bimas,Bendera,1,Baik
Bimas,Lambang Garuda Pancasila,7,Baik
Bimas,Gorden,6,Baik
Bimas,Karpet,2,Baik
Bimas,Dispenser,1,Baik
Bimas,Kipas Angin,1,Baik
Bimas,Camera Digital,1,Baik
Bimas,Handycam,1,Baik
Bimas,Proyektor/Infocus,1,Baik
Bimas,Layar Proyektor/Screen,1,Baik
Bimas,Wireless Amplifier,1,Baik
Bimas,Megaphone,3,Baik
Bimas,A.C. Split,2,Baik
Bimas,Tiang Bendera,2,Baik
Bimas,Drone,1,Baik
Bimas,Kursi Dorong,5,Baik
Bimas,P.C Unit,3,Baik
Bimas,Lap Top,2,Baik
Bimas,Laptop,6,Baik
Bimas,Personal Komputer Lainnya,1,Baik
Bimas,Komputer Unit Lainnya,1,Baik
Bimas,Printer (Peralatan Personal Komputer),15,Baik
Bimas,Scanner (Peralatan Personal Komputer),1,Baik
Bimas,External/ Portable Hardisk,2,Baik
Bimas,Bangunan Gedung Kantor Permanen,6,Baik
Bimas,Pagar Permanen,1,Baik
Pendis,Lemari Besi/Metal,1,Baik
Pendis,Meja Kerja Besi/Metal,2,Baik
Pendis,Kursi Besi/Metal,6,Baik
Pendis,Kursi Dorong,1,Baik
Pendis,P.C Unit,1,Baik
Pendis,Laptop,4,Baik
Pendis,Printer (Peralatan Personal Komputer),1,Baik
Umrah dan Haji,Sepeda Motor,1,Baik
Umrah dan Haji,Lemari Besi/Metal,1,Baik
Umrah dan Haji,Kursi Besi/Metal,4,Baik
Umrah dan Haji,Sound System,1,Baik
Umrah dan Haji,Video Conference,1,Baik
Umrah dan Haji,P.C Unit,1,Baik
Umrah dan Haji,Note Book,1,Baik
Umrah dan Haji,Scanner (Peralatan Personal Komputer),1,Baik
Hindu,Lemari Besi/Metal,1,Baik
Hindu,Kursi Besi/Metal,1,Baik
Hindu,Meja Ketik,1,Baik
Hindu,Kipas Angin,1,Baik
Hindu,P.C Unit,1,Baik
Hindu,Laptop,1,Baik
Hindu,Printer (Peralatan Personal Komputer),1,Baik
Katolik,Lemari Besi/Metal,2,Baik
Katolik,LCD Projector/Infocus,1,Baik
Katolik,Meja Kerja Kayu,3,Baik
Katolik,Kursi Besi/Metal,28,Baik
Katolik,Laptop,3,Baik
Katolik,Printer (Peralatan Personal Komputer),4,Baik
Katolik,Scanner (Peralatan Personal Komputer),2,Baik`;

        // --- GLOBAL VARIABLES ---
        let inventoryData = [];
        let assetsByUnitChartInstance = null;
        let topItemsChartInstance = null;

        // --- FUNCTIONS ---

        // Function to switch between pages
        function showPage(pageId) {
            document.getElementById('home').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById(pageId).classList.remove('hidden');
            if(pageId === 'dashboard') {
                 // Re-initialize charts to handle resize and display issues
                if (assetsByUnitChartInstance) assetsByUnitChartInstance.destroy();
                if (topItemsChartInstance) topItemsChartInstance.destroy();
                initializeDashboard();
            }
        }

        // Function to parse CSV text into an array of objects
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            return lines.slice(1).map(line => {
                const values = line.split(',');
                let obj = {};
                headers.forEach((header, i) => {
                    // Handle cases where values might have commas inside, though this simple parser assumes they don't.
                    // A more robust solution would handle quoted values.
                    obj[header] = values[i] ? values[i].trim() : '';
                });
                return obj;
            });
        }

        // Initialize the dashboard with data
        function initializeDashboard() {
            // Populate filter dropdown
            const units = [...new Set(inventoryData.map(item => item.Unit))];
            const filterDropdown = document.getElementById('unit-filter');
            // Clear previous options except the first one
            while (filterDropdown.options.length > 1) {
                filterDropdown.remove(1);
            }
            units.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit;
                option.textContent = unit;
                filterDropdown.appendChild(option);
            });
            
            // Initial render
            updateDashboard();
        }

        // Update all dashboard components
        function updateDashboard(unitFilter = 'all', searchTerm = '') {
            let filteredData = inventoryData;

            if (unitFilter !== 'all') {
                filteredData = filteredData.filter(item => item.Unit === unitFilter);
            }

            if (searchTerm) {
                const lowerCaseSearchTerm = searchTerm.toLowerCase();
                filteredData = filteredData.filter(item => 
                    item['Nama Barang'].toLowerCase().includes(lowerCaseSearchTerm)
                );
            }
            
            renderStats(filteredData, unitFilter === 'all' ? inventoryData : filteredData);
            renderAssetsByUnitChart(unitFilter === 'all' ? inventoryData : filteredData.filter(item => item.Unit === unitFilter));
            renderTopItemsChart(filteredData);
            renderTable(filteredData);
        }

        // Render statistics cards
        function renderStats(data, globalData) {
            const totalAssets = data.reduce((sum, item) => sum + parseInt(item.Jumlah || 0), 0);
            const uniqueItems = new Set(data.map(item => item['Nama Barang'])).size;
            const totalUnits = new Set(globalData.map(item => item.Unit)).size;
            const goodConditionItems = data.filter(item => item.Kondisi.toLowerCase() === 'baik').reduce((sum, item) => sum + parseInt(item.Jumlah || 0), 0);
            const goodConditionPercentage = totalAssets > 0 ? ((goodConditionItems / totalAssets) * 100).toFixed(0) : 0;

            document.getElementById('total-assets').textContent = totalAssets.toLocaleString('id-ID');
            document.getElementById('unique-items').textContent = uniqueItems;
            document.getElementById('total-units').textContent = totalUnits;
            document.getElementById('good-condition').textContent = `${goodConditionPercentage}%`;
        }

        // Render assets by unit chart
        function renderAssetsByUnitChart(data) {
            const ctx = document.getElementById('assetsByUnitChart').getContext('2d');
            const unitCounts = data.reduce((acc, item) => {
                acc[item.Unit] = (acc[item.Unit] || 0) + parseInt(item.Jumlah);
                return acc;
            }, {});

            const chartData = {
                labels: Object.keys(unitCounts),
                datasets: [{
                    label: 'Jumlah Aset',
                    data: Object.values(unitCounts),
                    backgroundColor: ['#34d399', '#60a5fa', '#f87171', '#fbbf24', '#a78bfa', '#c084fc', '#f472b6'],
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            };

            if (assetsByUnitChartInstance) {
                assetsByUnitChartInstance.destroy();
            }

            assetsByUnitChartInstance = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
        
        // Render top items chart
        function renderTopItemsChart(data) {
            const ctx = document.getElementById('topItemsChart').getContext('2d');
            const itemCounts = data.reduce((acc, item) => {
                const itemName = item['Nama Barang'];
                acc[itemName] = (acc[itemName] || 0) + parseInt(item.Jumlah);
                return acc;
            }, {});

            const sortedItems = Object.entries(itemCounts).sort(([, a], [, b]) => b - a).slice(0, 5);

            const chartData = {
                labels: sortedItems.map(item => item[0]),
                datasets: [{
                    label: 'Jumlah',
                    data: sortedItems.map(item => item[1]),
                    backgroundColor: ['#3b82f6', '#10b981', '#ef4444', '#f59e0b', '#8b5cf6'],
                    hoverOffset: 4
                }]
            };

            if (topItemsChartInstance) {
                topItemsChartInstance.destroy();
            }

            topItemsChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: chartData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        // Render data table
        function renderTable(data) {
            const tableBody = document.getElementById('inventory-table-body');
            tableBody.innerHTML = ''; // Clear existing rows
            if(data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-8 text-gray-500">Data tidak ditemukan.</td></tr>`;
                return;
            }
            data.forEach(item => {
                const row = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.Unit}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${item['Nama Barang']}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${parseInt(item.Jumlah).toLocaleString('id-ID')}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${item.Kondisi.toLowerCase() === 'baik' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${item.Kondisi}
                            </span>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            inventoryData = parseCSV(csvData);
            
            // Setup event listeners for filters
            const unitFilter = document.getElementById('unit-filter');
            const tableSearch = document.getElementById('table-search');

            unitFilter.addEventListener('change', () => {
                updateDashboard(unitFilter.value, tableSearch.value);
            });
            
            tableSearch.addEventListener('input', () => {
                updateDashboard(unitFilter.value, tableSearch.value);
            });

            // Initially show home page
            showPage('home');
        });

    </script>
</body>
</html>

